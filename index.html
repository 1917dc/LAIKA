<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="ISO 8859-1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <title>Relatório de Consórcio</title>
    <style>
        /* Reset */
        * {
            margin: 0;
            padding: 0;
        }

        body {
            margin: 5px;
        }
        .prevent-select{
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>

<body>
    <div class="container mt-2">
        <!-- Header -->
        <div class="row mb-4 mt-4">
            <div class="col-6">
                <h3 class="prevent-select">Relatório de Vendas</h3>
            </div>

            <div class="col-6 text-right">
                <button id="btnAdicionar" type="button" class="btn btn-dark">+ Adicionar Venda</button>
            </div>
            
        </div>
        <!-- Tabela -->
        <table class="table table-hover table-dark">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Cargo</th>
                    <th>Código do Vendedor</th>
                    <th>Valor de Venda</th>
                    <th>Código de Venda</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <!-- <tr>
                        <td>Fulano</td>
                        <td>senior</td>
                        <td>001</td>
                        <td>999.99</td>
                        <td>1%</td>
                        <td>Editar/excluir</td>
                    </tr> -->
            </tbody>
        </table>
        <div class="text-center">
            <button type="button" id="gerarBtn" class="btn btn-dark">Gerar Relatório</button>
        </div>
    </div>

    <!-- Modal -->
    <div id="modalAdicionarContato" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Nova Venda</h5>
                    <button type="button" class="close" id="closeModal">&times;</button>
                </div>

                <div class="modal-body ">
                    <form id="formAdicionarVenda">
                        <div class="form-group">
                            <label for="nome">Nome:</label>
                            <input type="text" class="form-control" id="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="cargo">Cargo:</label>
                            <input type="text" class="form-control" id="cargo" required>
                        </div>
                        <div class="form-group">
                            <label for="totalVendas">Código do Vendedor:</label>
                            <input type="number" class="form-control" id="codVendedor" required>
                        </div>
                        <div class="form-group">
                            <label for="maiorVenda">Valor de venda:</label>
                            <input type="number" class="form-control" id="valVenda" required>
                        </div>
                        <div class="form-group">
                            <label for="comissao">Código de Venda:</label>
                            <input type="number" class="form-control" id="codVenda" required>
                        </div>
                        <!-- Dispara o evento 'submit', pode ser resgatado no JS -->
                        <button type="submit" class="btn btn-dark">Salvar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!----------------------------- OVERLAY ----------------------------------->
    <!-- position: fixed define a origem do bloco, que ocupará a tela inteira (0, 0) -->
    <div id="overlay" style="
            height: 100%;
            width: 100%;
            background-color: rgb(0, 0, 0, 0.5);
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2;"></div>

    <script>
        const minhaModal = document.getElementById("modalAdicionarContato");
        const btnAdicionar = document.getElementById("btnAdicionar");
        const btnFechar = document.getElementById("closeModal");
        const overlay = document.getElementById("overlay");
        const gerarBtn = document.getElementById('gerarBtn');
        let vendas = [
            {nome: 'Luiz', cargo: 'pleno', codVendedor: '0', valVenda: '1000', codVenda: '01'}
        ]; // Array para armazenar os objetos da tabela
        let modoEdicao = false;
        let indiceEdicao = null;

        if(vendas.length < 1){
            gerarBtn.style.display = 'none'
        } else{
            gerarBtn.style.display= 'block'
        }

        function renderizarTabela() {
            let tabela = document.querySelector('.table tbody');
            tabela.innerHTML = '' // Limpa a tabela
            for (let c = 0; c < vendas.length; c++) {
                vendas[c].valVenda = parseFloat(vendas[c].valVenda)
                    let valVendaFormatado = vendas[c].valVenda.toLocaleString('pt-BR',{
                        style: 'currency',
                        currency:'BRL'
                    })
                // Usando string literais dentro de crases para escrita multi-linha
                // Usando também template strings (interpolação de variáveis dentro de strings)
                let novaLinha = `<tr>
                                        <td>${vendas[c].nome}</td>
                                        <td>${vendas[c].cargo}</td>
                                        <td>${vendas[c].codVendedor}</td>
                                        <td>${valVendaFormatado}</td>
                                        <td>${vendas[c].codVenda}</td>
                                        <td><button type="button" class="btn btn-light btn-sm" onclick="atualizarDados(${c})">Editar</button></td>
                                    </tr>`;
                // Adiciona conteúdo da variável 'novaLinha' na tabela
                tabela.innerHTML += novaLinha;
            }
        }

        function abrirModal() {
            minhaModal.style.display = "block";
            overlay.style.display = "block";
        }

        function fecharModal() {
            minhaModal.style.display = "none";
            overlay.style.display = "none";
            limparFormulario();
        }

        function limparFormulario() {
            document.getElementById('formAdicionarVenda').reset();
            modoEdicao = false;
            indiceEdicao = null;
        }

        // Ouvidor de evento de clique dos botões
        btnAdicionar.addEventListener("click", function () {
            abrirModal();
        });

        btnFechar.addEventListener("click", function () {
            fecharModal();
        });

        /* Adicionando uma nova linha na tabela no evento de 'submit' */
        // Poderia também usar o método: .onsubmit = function(event) {...}
        document.getElementById('formAdicionarVenda').addEventListener('submit', function (event) {
            // Prevenir o comportamento padrão do formulário
            event.preventDefault();

            // Armazenar os valores dos campos de input
            let nome = document.getElementById('nome').value;
            let cargo = document.getElementById('cargo').value;
            //total venda
            let codVendedor = document.getElementById('codVendedor').value;
            //maiorvenda
            let valVenda = document.getElementById('valVenda').value;
            //cod venda
            let codVenda = document.getElementById('codVenda').value;

            // Criando objeto (usando 'simple property')
            let venda = {
                nome: nome,         // nome: nome
                cargo,              // cargo : cargo
                codVendedor,           // totalVendas: totalVendas
                valVenda,               // maiorVenda: maiorVenda
                codVenda
            };

            if (modoEdicao) {
                // Se estiver em modo de edição, substitua o item existente
                vendas[indiceEdicao] = venda;
                modoEdicao = false;
                indiceEdicao = null;
            } else {
                // Caso contrário, adicione à lista
                vendas.push(venda);
            }

            renderizarTabela();
            fecharModal();

            // Debug
            console.log(vendas);
        });

        function atualizarDados(index) {
            const venda = vendas[index];
            abrirModal();

            document.getElementById('nome').value = venda.nome;
            document.getElementById('cargo').value = venda.cargo;
            document.getElementById('codVendedor').value = venda.codVendedor;
            document.getElementById('valVenda').value = venda.valVenda;
            document.getElementById('codVenda').value = venda.codVenda;

            modoEdicao = true;
            indiceEdicao = index;
        }
        document.addEventListener('DOMContentLoaded', renderizarTabela)
    </script>
</body>

</html>